<!-- Navigation Menu Template -->
<nav class="nav-container">
    <button class="nav-toggle" onclick="toggleNav()">â˜° Menu</button>
    <div class="nav-wrapper">
        <ul class="nav-menu" id="navMenu">
            <li class="nav-item">
                <a href="/" class="nav-link {% if page == 'index' %}active{% endif %}">
                    <span class="nav-icon">ğŸ </span>
                    <span>Accueil</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/audio-library" class="nav-link {% if page == 'audio_library' %}active{% endif %}">
                    <span class="nav-icon">ğŸµ</span>
                    <span>BibliothÃ¨que Audio</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/network-map" class="nav-link {% if page == 'network' %}active{% endif %}">
                    <span class="nav-icon">ğŸŒ</span>
                    <span>Carte RÃ©seau</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/beacons" class="nav-link {% if page == 'beacons' %}active{% endif %}">
                    <span class="nav-icon">ğŸ“¡</span>
                    <span>Beacons BLE</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/ble_debug" class="nav-link {% if page == 'ble_debug' %}active{% endif %}">
                    <span class="nav-icon">ğŸ”</span>
                    <span>Debug BLE</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/devices" class="nav-link {% if page == 'devices' %}active{% endif %}">
                    <span class="nav-icon">ğŸ“</span>
                    <span>Devices</span>
                </a>
            </li>
            <li class="nav-item">
                <button class="nav-action-btn" id="refreshBtn" onclick="triggerNetworkScan()" title="DÃ©clencher un scan Network Diagnostic">
                    <span class="nav-icon" id="refreshIcon">ğŸ”„</span>
                    <span>Scan RÃ©seau</span>
                </button>
            </li>
        </ul>
    </div>
</nav>

<script>
// Toggle navigation menu for mobile
function toggleNav() {
    const navMenu = document.getElementById('navMenu');
    navMenu.classList.toggle('active');
}

// DÃ©clencher un scan rÃ©seau Network Diagnostic
async function triggerNetworkScan() {
    const btn = document.getElementById('refreshBtn');
    const icon = document.getElementById('refreshIcon');

    // DÃ©sactiver le bouton et afficher le spinner
    btn.disabled = true;
    btn.classList.add('loading');
    icon.textContent = 'â³';

    try {
        const response = await fetch('/api/trigger_scan', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });

        const result = await response.json();

        if (result.success) {
            // SuccÃ¨s - afficher temporairement une coche
            icon.textContent = 'âœ…';
            console.log('âœ… Scan rÃ©seau dÃ©clenchÃ© avec succÃ¨s:', result.message);

            // Restaurer aprÃ¨s 2 secondes
            setTimeout(() => {
                icon.textContent = 'ğŸ”„';
                btn.disabled = false;
                btn.classList.remove('loading');
            }, 2000);
        } else {
            // Erreur
            icon.textContent = 'âŒ';
            console.error('âŒ Erreur scan rÃ©seau:', result.message);
            alert('Erreur: ' + (result.message || 'Impossible de dÃ©clencher le scan'));

            // Restaurer aprÃ¨s 3 secondes
            setTimeout(() => {
                icon.textContent = 'ğŸ”„';
                btn.disabled = false;
                btn.classList.remove('loading');
            }, 3000);
        }
    } catch (error) {
        // Erreur rÃ©seau
        icon.textContent = 'âŒ';
        console.error('âŒ Erreur lors du scan:', error);
        alert('Erreur rÃ©seau: ' + error.message);

        // Restaurer aprÃ¨s 3 secondes
        setTimeout(() => {
            icon.textContent = 'ğŸ”„';
            btn.disabled = false;
            btn.classList.remove('loading');
        }, 3000);
    }
}
</script>
